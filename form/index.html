<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>

  <style>
    #container {
      width: 80vw;
      margin: auto;
    }

    .flex {
      display: flex;
      gap: 0.5em;
    }

    .flex-col {
      flex-direction: column;
    }

    .flex-row {
      flex-direction: row;
    }

    .flex-shrink {
      flex-shrink: 3;
    }

    .flex-1 {
      flex: auto;
      overflow: auto;
    }

    .flex-0 {
      flex: 0;
    }

    .align-self-start {
      align-self: flex-start;
    }

    .fit {
      display: inline-block;
    }

    .min-width {
      max-width: 2.4em;
      min-width: 2.4em;
      width: 2.4em;
    }

    input[type="text"],
    select {
      height: 2em;
      display: inline-block;
      border: 1px solid #ccc;
      border-radius: 3px;
      cursor: pointer;
      box-sizing: border-box;
    }

    button {
      border: 1px solid #ccc;
      border-radius: 3px;
    }

    .agb {
      height: 8em;
      overflow-y: scroll;
    }

    .error[visible="true"] {
      color: red;
      display: block;
    }

    .error[visible="false"] {
      display: none;
    }
  </style>

  <body>
    <div id="container">
      <div class="flex flex-col">
        <h3>Ansprechpartner</h3>
        <!--Categories of users-->
        <select id="category" title="category">
          <option value="0">FF-Fischbach (15.12.)</option>
          <option value="1">Vereine (21.12.)</option>
          <option value="2">Privat (15.1.)</option>
        </select>

        <!--error message-->
        <div id="category_error" class="error" visible="true">
          Der ausgew√§hlte Zeitraum liegt in der Zukunft
        </div>

        <!--Input section-->
        <input id="contactFirst" type="text" title="contactFirst" placeholder="Vorname" />
        <input id="contactLast" type="text" title="contactLast" placeholder="Nachname" />

        <input
          id="contact_BirthDate"
          type="date"
          title="contact_BirthDate"
          placeholder="Geburtstag"
        />
        <input id="contactEmail" type="email" title="contactEmail" placeholder="E-Mail" />

        <input id="group" type="text" title="group" placeholder="Gruppenname" />
        <!--Additional participants-->
        <h3>Weitere Teilnehmer</h3>
        <div class="flex flex-col">
          <div id="list" class="flex flex-col"></div>
          <button id="add" class="align-self-start" type="button" onclick="addParticipant()">
            +
          </button>
        </div>
        <!--AGB section-->
        <div id="agb" class="agb">
          Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor
          invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et
          accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata
          sanctus est Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet, consetetur sadipscing
          elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed
          diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd
          gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet.
        </div>
        <div class="flex fit">
          <input id="agbCheck" type="checkbox" title="agb" disabled />
          <label>AGB</label>
        </div>

        <!--Submit Button-->
        <button
          id="submit"
          class="align-self-start"
          type="button"
          title="submit"
          onclick="submit()"
          disabled
        >
          Absenden
        </button>
      </div>
    </div>
  </body>

  <script>
    let hasError = false;
    let stayDisabled = false;
    const currentYear = new Date().getFullYear();
    const dates = [
      new Date(currentYear, 15, 11),
      new Date(currentYear, 21, 11),
      new Date(currentYear, 15, 0),
    ];

    /*input elements*/
    const contactFirst = document.getElementById("contactFirst");
    const contactLast = document.getElementById("contactLast");
    const contact_BirthDate = document.getElementById("contact_BirthDate");
    const contactEmail = document.getElementById("contactEmail");
    const group = document.getElementById("group");
    const addBtn = document.getElementById("add");
    const submitBtn = document.getElementById("submit");
    const agbCheck = document.getElementById("agbCheck");

    const category_error = document.getElementById("category_error");

    /*api model*/
    let form = {
      contactFirst: undefined,
      contactLast: undefined,
      contact_BirthDate: undefined,
      contactEmail: undefined,
      category: undefined,
      groupName: undefined,
      participantList: [],
    };

    const submit = () => {
      /*fetch('', {
            method: 'POST',
            body: JSON.stringify(form)
          })*/

      console.log(form);
    };

    const setInputsDisables = (isDisabled) => {
      contactFirst.disabled = isDisabled;
      contactLast.disabled = isDisabled;
      contact_BirthDate.disabled = isDisabled;
      contactEmail.disabled = isDisabled;
      group.disabled = isDisabled;

      if (stayDisabled) {
        submitBtn.disabled = true;
      }
    };

    /*form input listener*/
    const addListeners = () => {
      contactFirst.addEventListener("change", (evt) => (form.contactFirst = evt.target.value));
      contactLast.addEventListener("change", (evt) => (form.contactLast = evt.target.value));
      contact_BirthDate.addEventListener("change", (evt) => (form.birthDate = evt.target.value));
      contactEmail.addEventListener("change", (evt) => (form.contactEmail = evt.target.value));
      group.addEventListener("change", (evt) => (form.contactEmail = evt.target.value));

      /*Category*/
      document.getElementById("category").addEventListener("change", (evt) => {
        const selection = dates[evt.target.value];

        form.category = selection;

        const isDisabled = selection > new Date();
        stayDisabled = isDisabled;

        category_error.visible = !isDisabled;

        setInputsDisables(isDisabled);
      });

      /*AGB check*/
      document.getElementById("agb").addEventListener("scrollend", (evt) => {
        const submitBtn = document.getElementById("submit");
        if (!stayDisabled) {
          submitBtn.disabled = false;
          agbCheck.checked = true;
        }
      });
    };

    /*Adds participants to list*/
    const addParticipant = () => {
      const list = document.getElementById("list");

      const container = document.createElement("div");
      container.className = "flex";

      const firstName = document.createElement("input");
      const lastName = document.createElement("input");
      const birthDate = document.createElement("input");
      const deleteBtn = document.createElement("button");

      /*Firstname input properties*/
      firstName.placeholder = "Vorname";
      firstName.setAttribute("type", "text");

      /*Lastname input properties*/
      lastName.placeholder = "Nachname";
      lastName.setAttribute("type", "text");

      /*Delete Button properties*/
      birthDate.setAttribute("type", "date");
      birthDate.style = "min-width: 7.5em";

      /*Delete Button properties*/
      deleteBtn.innerHTML = "üóëÔ∏è";
      deleteBtn.style = "background-color: red";
      deleteBtn.className = "min-width";
      deleteBtn.labels = "birth date";
      deleteBtn.setAttribute("type", "button");

      const inputs = [firstName, lastName, birthDate, deleteBtn];

      const obj = {
        firstName: "",
        lastName: "",
        birthDate: "",
      };

      /*set further participant properties*/
      firstName.addEventListener("change", (evt) => (obj.firstName = evt.target.value));
      lastName.addEventListener("change", (evt) => (obj.lastName = evt.target.value));
      birthDate.addEventListener("change", (evt) => (obj.birthDate = evt.target.value));

      /*remove participant from list*/
      deleteBtn.addEventListener("click", (evt) => {
        list.removeChild(container);
        form.participantList = form.participantList.filter((e) => e !== obj);
      });

      for (let e of inputs) {
        e.classList.add("flex-1");
        container.appendChild(e);
      }

      form.participantList.push(obj);
      list.appendChild(container);
    };

    /*initial function calls*/
    addListeners();
  </script>
</html>
